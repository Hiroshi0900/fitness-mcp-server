# タスク一覧と進捗

## 現在のステータス
🔄 **Phase 1: 基盤整備** - 進行中

## Phase 1: 基盤整備（既存機能への影響なし）

### ✅ 完了済み
- [x] プロジェクト計画書作成
- [x] タスク管理構造構築
- [x] 要件定義・設計確定

### 🔄 進行中
- [ ] **T1-1**: `003_add_running_tables.sql`マイグレーション作成
  - 担当: Claude
  - 期限: 今日
  - 詳細: ランニング専用テーブルとインデックス、ビューを作成

### ⏳ 予定
- [ ] **T1-2**: マイグレーション実行・検証
  - 依存: T1-1
  - 詳細: 既存DBに対してマイグレーション実行し、既存機能への影響を確認

- [ ] **T1-3**: 既存DBとの共存確認
  - 依存: T1-2
  - 詳細: 筋トレ機能が正常動作することを確認

## Phase 2: Repository層（独立実装）

### ⏳ 予定
- [ ] **T2-1**: `RunningRepository`インターフェース定義
  - 依存: Phase 1完了
  - ファイル: `internal/interface/repository/running_repository.go`

- [ ] **T2-2**: SQLite実装クラス作成
  - 依存: T2-1
  - ファイル: `internal/infrastructure/repository/sqlite/running_repository.go`

- [ ] **T2-3**: 既存Repositoryとの分離確認
  - 依存: T2-2
  - 詳細: 筋トレRepositoryと独立して動作することを確認

## Phase 3: Application層（独立実装）

### ⏳ 予定
- [ ] **T3-1**: `RecordRunningCommand`DTO作成
  - 依存: Phase 2完了
  - ファイル: `internal/application/command/dto/running_dto.go`

- [ ] **T3-2**: `RunningCommandHandler`実装
  - 依存: T3-1
  - ファイル: `internal/application/command/handler/running_handler.go`

- [ ] **T3-3**: 既存ハンドラーとの分離確認
  - 依存: T3-2
  - 詳細: 筋トレハンドラーと独立して動作することを確認

## Phase 4: MCPツール追加（既存ツールと並行）

### ⏳ 予定
- [ ] **T4-1**: `record_running`ツール作成
  - 依存: Phase 3完了
  - ファイル: `internal/interface/mcp-tool/tool/running_tool.go`

- [ ] **T4-2**: MCPサーバーへのツール登録
  - 依存: T4-1
  - ファイル: `cmd/mcp/main.go`の更新

- [ ] **T4-3**: 既存`record_training`ツールとの並行動作確認
  - 依存: T4-2
  - 詳細: 両ツールが同時に正常動作することを確認

- [ ] **T4-4**: エラーハンドリング独立性確認
  - 依存: T4-3
  - 詳細: 一方のエラーが他方に影響しないことを確認

## Phase 5: 統合検証

### ⏳ 予定
- [ ] **T5-1**: 両機能の並行動作テスト
  - 依存: Phase 4完了
  - 詳細: 筋トレとランニングの記録を交互に実行

- [ ] **T5-2**: データベースファイル整合性確認
  - 依存: T5-1
  - 詳細: データの破損や競合状態がないことを確認

- [ ] **T5-3**: 既存機能の回帰テスト
  - 依存: T5-2
  - 詳細: 筋トレ機能の全テストケースを再実行

## リスク管理

### 🚨 高リスク
- **データベースの破損**: 既存データへの影響
- **依存関係の競合**: 共有モジュールでの問題

### ⚠️ 中リスク
- **パフォーマンス劣化**: 新テーブル追加による影響
- **メモリ使用量増加**: 新ドメインモデル追加による影響

### 📝 注意事項
- 各Phase完了時に既存機能のテストを実行
- データベースバックアップを事前に作成
- 問題発生時はすぐにロールバック可能にする

## 次のアクション
1. **T1-1**の`003_add_running_tables.sql`作成を開始
2. 既存マイグレーションファイルの構造を参考にする
3. SQLiteの制約とインデックス設計を確認

---

**更新日**: 2025-06-16  
**次回レビュー**: T1-1完了時
